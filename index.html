<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Requirements for the design of a Substrate Protocol for User Datagrams (SPUD)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>
<style type="text/css">
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}

@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

body {
  font: 11pt cambria, helvetica, arial, sans-serif;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 1em auto;
  max-width: 700px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: candara, helvetica, arial, sans-serif;
  font-size-adjust: 0.5;
}
.title { font-size: 150%; }
h1 { font-size: 130%; }
h2 { font-size: 120%; }
h3, h4 { font-size: 110%; }

table {
  margin-left: 0em;
}
table.header {
  width: 100%;
}

table.header td {
  background-color: inherit;
  color: black;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}

pre.text, pre.text2 {
  width: 90%;
}

dt {
  float: left; clear: left;
  margin: 0.5em 0.5em 0 0;
}
dt:first-child {
  margin-top: 0;
}
dd {
  margin: 0.5em 0 0 2em;
}
dd p, dd ul {
  margin-top: 0; margin-bottom: 0;
}
dd *+p {
  margin-top: 0.5em;
}

ol, ul {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
ul.toc, ul.toc ul {
  margin: 0 0 0 1.5em;
}
ul.toc a:first-child {
  display: inline-block;
  min-width: 1.2em;
}
</style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Motivation"/>
<link href="#rfc.section.2" rel="Chapter" title="2 History"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Terminology"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Use Cases"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Functional Requirements"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Grouping of Packets (into &#x201C;tubes&#x201D;)"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Bidirectionality of Tubes"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Signaling of Per-Tube Properties"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Path to Receiver Signaling under Sender Control"/>
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Receiver to Sender Feedback"/>
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 Direct Path to Sender Signaling"/>
<link href="#rfc.section.5.7" rel="Chapter" title="5.7 Tube Start and End Signaling"/>
<link href="#rfc.section.5.8" rel="Chapter" title="5.8 Transport Semantic Signaling"/>
<link href="#rfc.section.5.9" rel="Chapter" title="5.9 Declarative signaling"/>
<link href="#rfc.section.5.10" rel="Chapter" title="5.10 Extensibility"/>
<link href="#rfc.section.5.11" rel="Chapter" title="5.11 Common Vocabulary"/>
<link href="#rfc.section.5.12" rel="Chapter" title="5.12 Additional Per-Packet Signaling"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Security Requirements"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Privacy"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Authentication"/>
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Integrity"/>
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Encrypted Feedback"/>
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 Preservation of Security Properties"/>
<link href="#rfc.section.6.6" rel="Chapter" title="6.6 Protection against trivial abuse"/>
<link href="#rfc.section.6.7" rel="Chapter" title="6.7 Continuum of trust among endpoints and middleboxes"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Technical Requirements"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Middlebox Traversal"/>
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Low Overhead in Network Processing"/>
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Implementability in User-Space"/>
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Incremental Deployability"/>
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 No unnecessary restrictions on the superstrate"/>
<link href="#rfc.section.7.6" rel="Chapter" title="7.6 Minimal additional start-up latency"/>
<link href="#rfc.section.7.7" rel="Chapter" title="7.7 Minimal header overhead"/>
<link href="#rfc.section.7.8" rel="Chapter" title="7.8 Minimal non-productive traffic"/>
<link href="#rfc.section.7.9" rel="Chapter" title="7.9 Endpoint Control"/>
<link href="#rfc.section.7.10" rel="Chapter" title="7.10 On Reliability, Fragmentation, MTU, and Duplication"/>
<link href="#rfc.section.7.11" rel="Chapter" title="7.11 SPUD Support Discovery"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations"/>
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 Contributors"/>
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgments"/>
<link href="#rfc.references" rel="Chapter" title="12 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Trammell, B., Ed. and M. Kuehlewind, Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-trammell-spud-req-04" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-5-10" />
  <meta name="dct.abstract" content="We have identified the potential need for a UDP-based encapsulation protocol to allow explicit cooperation with middleboxes while using new, encrypted transport protocols. This document proposes an initial set of requirements for such a protocol, and discusses tradeoffs to be made in further refining these requirements." />
  <meta name="description" content="We have identified the potential need for a UDP-based encapsulation protocol to allow explicit cooperation with middleboxes while using new, encrypted transport protocols. This document proposes an initial set of requirements for such a protocol, and discusses tradeoffs to be made in further refining these requirements." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">B. Trammell, Ed.</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">M. Kuehlewind, Ed.</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">ETH Zurich</td>
</tr>
<tr>
  <td class="left">Expires: November 11, 2016</td>
  <td class="right">May 10, 2016</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Requirements for the design of a Substrate Protocol for User Datagrams (SPUD)<br />
  <span class="filename">draft-trammell-spud-req-04</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>We have identified the potential need for a UDP-based encapsulation protocol to allow explicit cooperation with middleboxes while using new, encrypted transport protocols. This document proposes an initial set of requirements for such a protocol, and discusses tradeoffs to be made in further refining these requirements.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on November 11, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2016 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Motivation</a></li>
<li>2.   <a href="#rfc.section.2">History</a></li>
<li>3.   <a href="#rfc.section.3">Terminology</a></li>
<li>4.   <a href="#rfc.section.4">Use Cases</a></li>
<li>5.   <a href="#rfc.section.5">Functional Requirements</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Grouping of Packets (into &#8220;tubes&#8221;)</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Bidirectionality of Tubes</a></li>
<li>5.3.   <a href="#rfc.section.5.3">Signaling of Per-Tube Properties</a></li>
<li>5.4.   <a href="#rfc.section.5.4">Path to Receiver Signaling under Sender Control</a></li>
<li>5.5.   <a href="#rfc.section.5.5">Receiver to Sender Feedback</a></li>
<li>5.6.   <a href="#rfc.section.5.6">Direct Path to Sender Signaling</a></li>
<li>5.7.   <a href="#rfc.section.5.7">Tube Start and End Signaling</a></li>
<li>5.8.   <a href="#rfc.section.5.8">Transport Semantic Signaling</a></li>
<li>5.9.   <a href="#rfc.section.5.9">Declarative signaling</a></li>
<li>5.10.   <a href="#rfc.section.5.10">Extensibility</a></li>
<li>5.11.   <a href="#rfc.section.5.11">Common Vocabulary</a></li>
<li>5.12.   <a href="#rfc.section.5.12">Additional Per-Packet Signaling</a></li>
</ul><li>6.   <a href="#rfc.section.6">Security Requirements</a></li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Privacy</a></li>
<li>6.2.   <a href="#rfc.section.6.2">Authentication</a></li>
<li>6.3.   <a href="#rfc.section.6.3">Integrity</a></li>
<li>6.4.   <a href="#rfc.section.6.4">Encrypted Feedback</a></li>
<li>6.5.   <a href="#rfc.section.6.5">Preservation of Security Properties</a></li>
<li>6.6.   <a href="#rfc.section.6.6">Protection against trivial abuse</a></li>
<li>6.7.   <a href="#rfc.section.6.7">Continuum of trust among endpoints and middleboxes</a></li>
</ul><li>7.   <a href="#rfc.section.7">Technical Requirements</a></li>
<ul><li>7.1.   <a href="#rfc.section.7.1">Middlebox Traversal</a></li>
<li>7.2.   <a href="#rfc.section.7.2">Low Overhead in Network Processing</a></li>
<li>7.3.   <a href="#rfc.section.7.3">Implementability in User-Space</a></li>
<li>7.4.   <a href="#rfc.section.7.4">Incremental Deployability</a></li>
<li>7.5.   <a href="#rfc.section.7.5">No unnecessary restrictions on the superstrate</a></li>
<li>7.6.   <a href="#rfc.section.7.6">Minimal additional start-up latency</a></li>
<li>7.7.   <a href="#rfc.section.7.7">Minimal header overhead</a></li>
<li>7.8.   <a href="#rfc.section.7.8">Minimal non-productive traffic</a></li>
<li>7.9.   <a href="#rfc.section.7.9">Endpoint Control</a></li>
<li>7.10.   <a href="#rfc.section.7.10">On Reliability, Fragmentation, MTU, and Duplication</a></li>
<li>7.11.   <a href="#rfc.section.7.11">SPUD Support Discovery</a></li>
</ul><li>8.   <a href="#rfc.section.8">Security Considerations</a></li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a></li>
<li>10.   <a href="#rfc.section.10">Contributors</a></li>
<li>11.   <a href="#rfc.section.11">Acknowledgments</a></li>
<li>12.   <a href="#rfc.references">Informative References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#motivation" id="motivation">Motivation</a></h1>
<p id="rfc.section.1.p.1">A number of efforts to create new transport protocols or experiment with new network behaviors in the Internet have been built on top of UDP, as it traverses firewalls and other middleboxes more readily than new protocols do.  Each such effort must, however, either manage its flows within common middlebox assumptions for UDP or train the middleboxes on the new protocol (thus losing the benefit of using UDP). A common Substrate Protocol for User Datagrams (SPUD) would allow each effort to re-use a set of shared methods for notifying middleboxes of the flows&#8217; semantics, thus avoiding both the limitations of current flow semantics and the need to re-invent the mechanism for notifying the middlebox of the new semantics.</p>
<p id="rfc.section.1.p.2">As a concrete example, it is common for some middleboxes to tear down required state (such as NAT bindings) very rapidly for UDP flows. By notifying the path that a particular transport using UDP maintains session state and explicitly signals session start and stop using the substrate, the using protocol may reduce or avoid the need for heartbeat traffic.</p>
<p id="rfc.section.1.p.3">The intention of this work is to make it possible to define and deploy new transport protocols that use encryption to protect their own operation as well as the confidentiality, authenticity, integrity, and linkability resistance of their payloads. The accelerating deployment of encryption will render obsolete network operations techniques that rely on packet inspection and modification based upon assumptions about the protocols in use. This work will allow the replacement the current regime of middlebox inspection and modification of transport and application-layer headers and payload with one that allows inspection only of information explicitly exposed by the endpoints, and modification of such information only under endpoint control.</p>
<p id="rfc.section.1.p.4">Any selective exposure of traffic metadata outside a relatively restricted trust domain must be advisory, non-negotiated, and declarative rather than imperative. As with other signaling systems, exposure of specific elements must be carefully assessed for privacy risks and the total of exposed elements must be so assessed.  Each exposed parameter should also be independently verifiable, so that each entity can assign its own trust to other entities.  Basic transport over the substrate must continue working even if signaling is ignored or stripped, to support incremental deployment. These restrictions on vocabulary are discussed further in <a href="#I-D.trammell-stackevo-explicit-coop">[I-D.trammell-stackevo-explicit-coop]</a>.  This discussion includes privacy and trust concerns as well as the need for strong incentives for middlebox cooperation based on the information that are exposed.</p>
<p id="rfc.section.1.p.5">Within this document, requirements are presented for a facility implementable as an encapsulation protocol, atop which new transports (&#8220;superstrates&#8221;) can be built. Alternately, these could be viewed as a set of requirements for future transport protocol development without a layer separation between the transport and the superstrate.</p>
<p id="rfc.section.1.p.6">This document defines a specific set of requirements for a SPUD facility, based on analysis on a target set of applications. It is intended as the basis for determining the next steps to make progress in this space, including possibly chartering a working group for specific protocol engineering work.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#history" id="history">History</a></h1>
<p id="rfc.section.2.p.1">An outcome of the IAB workshop on Stack Evolution in a Middlebox Internet (SEMI) <a href="#RFC7663">[RFC7663]</a>, held in Zurich in January 2015, was a discussion on the creation of a substrate protocol to support the deployment of new transport protocols in the Internet. Assuming that a way forward for transport evolution in user space would involve encapsulation in UDP datagrams, the workshop noted that it may be useful to have a facility built atop UDP to provide minimal signaling of the semantics of a flow that would otherwise be available in TCP. At the very least, indications of first and last packets in a flow may assist firewalls and NATs in policy decision and state maintenance.  This facility could also provide minimal application-to- path and path-to-application signaling, though there was less agreement about what should or could be signaled here. Further transport semantics would be used by the protocol running atop this facility, but would only be visible to the endpoints, as the transport protocol headers themselves would be encrypted, along with the payload, to prevent inspection or modification.  This encryption might be accomplished by using DTLS <a href="#RFC6347">[RFC6347]</a> as a subtransport <a href="#I-D.huitema-tls-dtls-as-subtransport">[I-D.huitema-tls-dtls-as-subtransport]</a> or by other suitable methods.</p>
<p id="rfc.section.2.p.2">The Substrate Protocol for User Datagrams (SPUD) BoF was held at IETF 92 in Dallas in March 2015 to develop this concept further. Restrictions on vocabulary assumed in these requirements are derived from discussions during this BoF, based on experience with previous endpoint-to-middle and middle-to- endpoint signaling approaches as well as concerns about the privacy implications of endpoint-to-middle signaling.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.3.p.1">This document uses the following terms:</p>
<p/>

<ul>
  <li>Superstrate: The transport protocol or protocol stack &#8220;above&#8221; SPUD, that uses SPUD for explicit path cooperation and path traversal. The superstrate usually consists of a security layer (e.g. TLS, DTLS) and a transport protocol, or a transport protocol with integrated security features, to protect headers and payload above SPUD.</li>
  <li>Endpoint: One end of a communication session, located on a single node that is a source or destination of packets in that session. In this document, this term may refer to either the SPUD implementation at the endpoint, the superstrate implementation running over SPUD, or the applications running over that superstrate.</li>
  <li>Path: The sequence of Internet Protocol nodes and links that a given packet traverses from endpoint to endpoint.</li>
  <li>Middlebox: As defined in <a href="#RFC3234">[RFC3234]</a>, a middlebox is any intermediary device performing functions other than the normal, standard functions of an IP router on the datagram path between a source host and destination host; e.g. making decisions about forwarding behavior based on other than addressing information, and/or modifying a packet before forwarding.</li>
</ul>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#use-cases" id="use-cases">Use Cases</a></h1>
<p id="rfc.section.4.p.1">Use cases are outlined in more detail in <a href="#I-D.kuehlewind-spud-use-cases">[I-D.kuehlewind-spud-use-cases]</a>. We summarize some of the primary use cases below.</p>
<p id="rfc.section.4.p.2">The primary use case for endpoint to path signaling in the Internet making use of packet grouping, as described in the use case document, is the binding of limited related semantics (start, ack, and stop) to a flow or a group of packets within a flow that are semantically related in terms of the application or superstrate. By explicitly signaling start and stop semantics, a flow allows middleboxes to use those signals for setting up and tearing down their relevant state (NAT bindings, firewall pinholes), rather than requiring the middlebox to infer this state from continued traffic. At best, this would allow the application to reduce heartbeat traffic, which might result in reduced radio utilization and thus greater battery life on mobile platforms.</p>
<p id="rfc.section.4.p.3">SPUD could also be used to provide information relevant for network treatment for middleboxes as a replacement for deep packet inspection for traffic classification purposes, rendered ineffective by superstrate encryption. In this application, properties would be expressed in terms of network-relevant parameters (intended bandwidth, latency and loss sensitivity, etc.) as opposed to application-relevant semantics. See <a href="#I-D.trammell-stackevo-explicit-coop">[I-D.trammell-stackevo-explicit-coop]</a> for discussion on limitations in signaling in untrusted environments.</p>
<p id="rfc.section.4.p.4">SPUD may also provide some facility for SPUD-aware nodes on the path to signal some property of the path to the endpoints and other SPUD- aware nodes on the path. The primary use case for path to application signaling is parallel to the use of ICMP <a href="#RFC0792">[RFC0792]</a> and ICMPv6 <a href="#RFC4443">[RFC4443]</a>, in that it describes a set of conditions (including errors) that applies to the datagrams as they traverse the path. Since the signals here would traverse NATs in the same way as the traffic related to them, this use case would sidestep problems with ICMP availability in the deployed Internet.</p>
<p id="rfc.section.4.p.5">Link-layer characteristics of use to the transport layer (e.g., whether a high-transient-delay, highly-buffered link such as LTE is present on the path) could also be signaled using this path-to-endpoint facility.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#functional-requirements" id="functional-requirements">Functional Requirements</a></h1>
<p id="rfc.section.5.p.1">The following requirements detail the services that SPUD must provide to superstrates, endpoints, and middleboxes using SPUD.</p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#grouping-of-packets-into-tubes" id="grouping-of-packets-into-tubes">Grouping of Packets (into &#8220;tubes&#8221;)</a></h1>
<p id="rfc.section.5.1.p.1">Transport semantics and many properties of communication that endpoints may want to expose to middleboxes are bound to flows or groups of flows (5-tuples).  SPUD must therefore provide a basic facility for associating packets together (into what we call a &#8220;tube&#8221;, for lack of a better term) and associate information to these groups of packets. Each packet in a SPUD &#8220;flow&#8221; (determined by 5-tuple) belongs to exactly one tube. Notionally, a tube consists of a set of packets with a set of common properties, that should therefore receive equivalent treatment from the network; these tubes may or may not be related to separate semantic entities in the superstrate (e.g. SCTP streams), at the superstrate&#8217;s discretion.</p>
<p id="rfc.section.5.1.p.2">The simplest mechanisms for association involve the addition of an identifier to each packet in a tube. Other mechanisms that don&#8217;t directly encode the identifier in a packet header, but instead provide it in a way that it is simple to derive from other information available in the packet at the endpoints and along the path, are also possible. In any cases, for the purposes of this requirement we treat this identifier as a simple vector of N bits. The properties of the tube identifier are subject to tradeoffs on the requirements for privacy, security, ease of implementation, and header overhead efficiency.</p>
<p id="rfc.section.5.1.p.3">In determining the optimal size and scope for this tube identifier, we first assume that the 5-tuple of source and destination IP address, UDP port, and IP protocol identifier (17 for UDP) is used in the Internet as an existing flow identifier, due to the widespread deployment of network address and port translation. We conclude that SPUD tube IDs should be scoped to this 5-tuple.</p>
<p id="rfc.section.5.1.p.4">While a globally-unique identifier would allow easier state comparison and migration for mobility use cases, it would have two serious disadvantages.  First, N would need to be sufficiently large to minimize the probability of collision among multiple tubes having the same identifier along the same path during some period of time. A 128-bit UUID <a href="#RFC4122">[RFC4122]</a> or an identifier of equivalent size generated using an equivalent algorithm would probably be sufficient, at the cost of 128 bits of header space in every packet. Second, globally unique tube identifiers would also introduce new possibilities for user and node tracking, with a serious negative impact on privacy. We note that global identifiers for mobility, when necessary to expose to the path, can be supported separately from the tube identification mechanism, by using a generic tube-grouping application-to-path signaling bound to the tube.</p>
<p id="rfc.section.5.1.p.5">Even when tube IDs are scoped to 5-tuples, N must still be sufficiently large, and the bits in the identifier sufficiently random, that possession of a valid tube ID implies that a node can observe packets belonging to the tube. This reduces the chances of success of blind packet injection attacks of packets with guessed valid tube IDs.</p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#bidirectionality-of-tubes" id="bidirectionality-of-tubes">Bidirectionality of Tubes</a></h1>
<p id="rfc.section.5.2.p.1">When scoped to 5-tuples, the forward and backward directions of a bidirectional connection will have different tube IDs, since these will necessarily take different paths and may interact with a different set of middleboxes due to asymmetric routing. SPUD will therefore require some facility to note that one tube is the &#8220;reverse&#8221; direction of another, a general case of the tube grouping signal above.</p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> <a href="#signaling-of-per-tube-properties" id="signaling-of-per-tube-properties">Signaling of Per-Tube Properties</a></h1>
<p id="rfc.section.5.3.p.1">SPUD must be able to provide information scoped to a tube from the end- point(s) to all SPUD-aware nodes on the path about the packets in that tube.</p>
<p id="rfc.section.5.3.p.2">We note that in-band signaling would meet this requirement.</p>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> <a href="#path-to-receiver-signaling-under-sender-control" id="path-to-receiver-signaling-under-sender-control">Path to Receiver Signaling under Sender Control</a></h1>
<p id="rfc.section.5.4.p.1">SPUD must be able to provide information about from a SPUD-aware middlebox to the endpoint. This information is associated with a tube, in terms of &#8220;the properties of the path(s) the packets in this tube will traverse&#8221;. This signaling must happen only with explicit sender permission and be sent to the receiver of packets in the tube.</p>
<p id="rfc.section.5.4.p.2">We note that in-band signaling would meet this requirement, if the sender created a &#8220;placeholder&#8221; in-band that could be filled in by the middlebox(es) on path. In-band signaling has the advantage that it does not require foreknowledge of the identity and addresses of devices along the path by endpoints and vice versa, but does add complexity to the signaling protocol.  Piggybacked signaling uses some number of bits in each packet generated by the overlying transport. It requires either reducing the MTU available to the encapsulated transport and/or opportunistically using &#8220;headroom&#8221; as it is available: bits between the network-layer MTU and the bits actually used by the transport. For use cases that accumulate information from devices on path in the SPUD header, piggybacked signaling also requires a mechanism for endpoints to create &#8220;scratch space&#8221; for potential use of the on-path devices.</p>
<p id="rfc.section.5.4.p.3">In contrast, interleaved signaling uses signaling packets on the same 5-tuple and tube ID, which don&#8217;t carry any superstrate data. These interleaved packets could also contain scratch space for on-path device use. This reduces complexity and sidesteps MTU problems, at the cost of sending more packets per flow.</p>
<h1 id="rfc.section.5.5"><a href="#rfc.section.5.5">5.5.</a> <a href="#receiver-to-sender-feedback" id="receiver-to-sender-feedback">Receiver to Sender Feedback</a></h1>
<p id="rfc.section.5.5.p.1">SPUD must be able send information collected from SPUD-aware middleboxes along the path to a receiver back to the sender that gave permission; see <a href="#encrypted-feedback">Section 6.4</a> for restrictions on this facility.</p>
<h1 id="rfc.section.5.6"><a href="#rfc.section.5.6">5.6.</a> <a href="#direct-path-to-sender-signaling" id="direct-path-to-sender-signaling">Direct Path to Sender Signaling</a></h1>
<p id="rfc.section.5.6.p.1">SPUD must provide a facility for a middlebox to send a packet directly in response to a sending endpoint, primarily to signal error conditions (e.g.  &#8220;packet administratively prohibited&#8221; or &#8220;no route to destination&#8221;, as in present ICMP).</p>
<p id="rfc.section.5.6.p.2">In this case, the direct return packet generated by the middlebox uses the reversed end-to-end 5-tuple in order to receive equivalent NAT treatment, though the reverse path might not be the same as the forward path. Endpoints have control over this feature: A SPUD-aware middlebox must not emit a direct return packet unless it is in direct response to a packet from a sending endpoint, and must not forward a packet for which it has sent a direct return packet; see <a href="#protection-against-trivial-abuse">Section 6.6</a> and <a href="#endpoint-control">Section 7.9</a>.</p>
<h1 id="rfc.section.5.7"><a href="#rfc.section.5.7">5.7.</a> <a href="#tube-start-and-end-signaling" id="tube-start-and-end-signaling">Tube Start and End Signaling</a></h1>
<p id="rfc.section.5.7.p.1">SPUD must provide a facility for endpoints to signal that a tube has started, that the start of the tube has been acknowledged and accepted by the remote endpoint(s), and that a tube has ended and its state can be forgotten by the path. Given unreliable signaling (see<br/> <a href="#on-reliability-fragmentation-mtu-and-duplication">Section 7.10</a>), both endpoints and devices on the path must be resilient to the loss of any of these signals. Specifically, timeouts are still necessary to clean up stale state.</p>
<h1 id="rfc.section.5.8"><a href="#rfc.section.5.8">5.8.</a> <a href="#transport-semantic-signaling" id="transport-semantic-signaling">Transport Semantic Signaling</a></h1>
<p id="rfc.section.5.8.p.1">Similar to tube start and end signaling, SPUD must provide a facility for endpoints to signal that a superstrate transport session has been requested, set up, and/or torn down. This facility provides an explicit replacement for the common practice in TCP-aware middleboxes of modeling TCP state of flows by inspecting the TCP flags byte.</p>
<p id="rfc.section.5.8.p.2">Given the fact that a superstrate transport session may consist of multiple tubes, this signaling must be separate from that for tube start and end.</p>
<h1 id="rfc.section.5.9"><a href="#rfc.section.5.9">5.9.</a> <a href="#declarative-signaling" id="declarative-signaling">Declarative signaling</a></h1>
<p id="rfc.section.5.9.p.1">All information signaled via SPUD is defined to be declarative (as opposed to imperative). A SPUD endpoint must function correctly even no middlebox along the path understands the signals it sends, or if sent signals from middleboxes it does not understand. It must also function correctly if the path (and thereby the set of middleboxes traversed) changes during the lifetime of a tube; endpoints cannot rely on the creation or maintenance of state even on cooperative middleboxes. Likewise, a SPUD-aware middlebox must function correctly if sent signals from endpoints it does not understand, or in the absence of expected signals from endpoints.</p>
<p id="rfc.section.5.9.p.2">The declarative nature of this signaling removes any requirement that SPUD provide reliability for its signals.</p>
<h1 id="rfc.section.5.10"><a href="#rfc.section.5.10">5.10.</a> <a href="#extensibility" id="extensibility">Extensibility</a></h1>
<p id="rfc.section.5.10.p.1">SPUD must enable multiple new transport semantics and application/path declarations without requiring updates to SPUD implementations in middleboxes.</p>
<p id="rfc.section.5.10.p.2">The use of SPUD for experimental signaling must be possible either without the registration of codepoints or namespaces with IANA, or with trivially easy (First Come, First Served <a href="#RFC5226">[RFC5226]</a> registration of such codepoints.</p>
<h1 id="rfc.section.5.11"><a href="#rfc.section.5.11">5.11.</a> <a href="#common-vocabulary" id="common-vocabulary">Common Vocabulary</a></h1>
<p id="rfc.section.5.11.p.1">For the interoperability of SPUD endpoints and middleboxes with each other, the use of SPUD for standard signaling must use a common vocabulary with registered codepoints allocated under relatively restrictive policy. This restrictive policy serves primarily security and privacy goals (i.e., reducing the risk of misuse of the extensibility provided by the protocol).</p>
<p id="rfc.section.5.11.p.2">We note that an IANA registry requiring Standards Action {RFC5226}} to modify would meet this requirement.</p>
<h1 id="rfc.section.5.12"><a href="#rfc.section.5.12">5.12.</a> <a href="#additional-per-packet-signaling" id="additional-per-packet-signaling">Additional Per-Packet Signaling</a></h1>
<p id="rfc.section.5.12.p.1">SPUD may provide a facility for signaling semantically simple information (similar to tube start and end) on a per-packet as opposed to a per-tube basis. Properties signaled per packet reduce state requirements at middleboxes, but also increase per-packet overhead. Small signal size (in bits of entropy) and encoding efficiency (in bits on the wire) is therefore more important for per-packet signaling that per-tube signaling. If per-packet signals need to be used by multiple hops along a path, these will need to be encoded in an efficiently-implementable way (i.e., using fixed-length, constant-offset data structures).</p>
<p id="rfc.section.5.12.p.2">Given these constraints, per-packet signaling is necessary for certain use cases, it is likely that SPUD will provide a very limited set of per-packet signals using flags in a SPUD header, and require all more complex properties to be bound per-tube.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#security-requirements" id="security-requirements">Security Requirements</a></h1>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> <a href="#privacy" id="privacy">Privacy</a></h1>
<p id="rfc.section.6.1.p.1">SPUD must allow endpoints to control the amount of information exposed to middleboxes, with the default being the minimum necessary for correct functioning. This includes the cryptographic protection of transport layer headers from inspection by devices on path, in order to prevent ossification of these headers.</p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> <a href="#authentication" id="authentication">Authentication</a></h1>
<p id="rfc.section.6.2.p.1">The basic SPUD protocol must not require any authentication or a priori trust relationship between endpoints and middleboxes to function.  However, SPUD should interoperate with the presentation/exchange of authentication information in environments where a trust relationship already exists, or can be easily established, either in-band or out-of-band, and use this information where possible and appropriate.</p>
<p id="rfc.section.6.2.p.2">Given the advisory nature of the signaling it supports, SPUD may also support eventual authentication: authentication of a signal after the reception of a packet after that containing the signal.</p>
<h1 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3.</a> <a href="#integrity" id="integrity">Integrity</a></h1>
<p id="rfc.section.6.3.p.1">SPUD must be able to provide integrity protection of information exposed by endpoints in SPUD-encapsulated packets, though the details of this integrity protection are still open.</p>
<p id="rfc.section.6.3.p.2">Endpoints should be able to detect changes to headers SPUD uses for its own signaling (whether due to error, accidental modification, or malicious modification), as well as the injection of packets into a SPUD flow (defined by 5-tuple) or tube by nodes other than the remote endpoints. Errors and accidental modifications can be detected using a simple checksum over the SPUD header, while detecting malicious modifications requires cryptographic integrity protection. Similar to <a href="#authentication">Section 6.2</a>, cryptographic integrity protection may also be eventual.</p>
<p id="rfc.section.6.3.p.3">Integrity protection of the superstrate is left up to the superstrate.</p>
<h1 id="rfc.section.6.4"><a href="#rfc.section.6.4">6.4.</a> <a href="#encrypted-feedback" id="encrypted-feedback">Encrypted Feedback</a></h1>
<p id="rfc.section.6.4.p.1">As feedback from a receiver to a sender (see <a href="#receiver-to-sender-feedback">Section 5.5</a>) does not need to be exposed to the path, this feedback channel should be encrypted for confidentiality and authenticity, when available (see <a href="#authentication">Section 6.2</a>). This facility will rely on cooperation with the superstrate or some other out-of-band mechanism to provide these guarantees.</p>
<h1 id="rfc.section.6.5"><a href="#rfc.section.6.5">6.5.</a> <a href="#preservation-of-security-properties" id="preservation-of-security-properties">Preservation of Security Properties</a></h1>
<p id="rfc.section.6.5.p.1">The use of SPUD must not weaken the essential security properties of the superstrate: confidentiality, integrity, authenticity, and defense against linkability. If the superstrate includes payload encryption for confidentiality, for example, the use of SPUD must not allow deep packet inspection systems to have access to the plaintext. Likewise, the use of SPUD must not create additional opportunities for linkability not already existing in the superstrate.</p>
<h1 id="rfc.section.6.6"><a href="#rfc.section.6.6">6.6.</a> <a href="#protection-against-trivial-abuse" id="protection-against-trivial-abuse">Protection against trivial abuse</a></h1>
<p id="rfc.section.6.6.p.1">Malicious background traffic is a serious problem for UDP-based protocols due to the ease of forging source addresses in UDP together with only limited deployment of network egress filtering <a href="#RFC2827">[RFC2827]</a>. Trivial abuse includes flooding and state exhaustion attacks, as well as reflection and amplification attacks.  SPUD must provide minimal protection against this trivial abuse. This implies that SPUD should provide:</p>
<p/>

<ul>
  <li>a proof of return routability, that the endpoint identified by a packet&#8217;s source address receives packets sent to that address;</li>
  <li>a feedback channel between endpoints;</li>
  <li>a method to probabilistically discriminiate legitimate SPUD traffic from reflected malicious traffic;</li>
  <li>a method to probabilistically discriminate SPUD traffic from on-path devices from devices off-path; and</li>
  <li>the ability to deploy mechanisms to protect against state exhaustion and other denial-of-service attacks against SPUD itself.</li>
</ul>
<p id="rfc.section.6.6.p.3">We note that using a &#8220;magic number&#8221; or other pattern of bits in an encapsulation-layer header not used in any widely deployed protocol has the nice property that no existing node in the Internet can be induced to reflect traffic containing it. This allows the magic number to provide probabilistic assurance that a given packet is not reflected, assisting in meeting this requirement.</p>
<p id="rfc.section.6.6.p.4">If SPUD is implemented over UDP, see <a href="#I-D.ietf-tsvwg-rfc5405bis">[I-D.ietf-tsvwg-rfc5405bis]</a> for guidelines on the safe usage of UDP in the Internet, which addresses some of these issues.</p>
<h1 id="rfc.section.6.7"><a href="#rfc.section.6.7">6.7.</a> <a href="#continuum-of-trust-among-endpoints-and-middleboxes" id="continuum-of-trust-among-endpoints-and-middleboxes">Continuum of trust among endpoints and middleboxes</a></h1>
<p id="rfc.section.6.7.p.1">There are different security considerations for different security contexts.  The end-to-end context is one; anything that only needs to be seen by the path shouldn&#8217;t be exposed in SPUD, but rather by the superstrate. There are multiple different types of end-to-middle context based on levels of trust between end and middle &#8211; is the middlebox on the same network as the endpoint, under control of the same owner? Is there some contract between the application user and the middlebox operator? SPUD should support different levels of trust than the default (&#8220;untrusted, but presumed honest due to limitations on the signaling vocabulary&#8221;) and fully-authenticated; how these points along the continuum are to be implemented and how they relate to each other needs to be explored further.</p>
<p id="rfc.section.6.7.p.2">In the Internet, it is not in the general case possible for the endpoint to authenticate every middlebox that might see packets it sends and receives. In this case information produced by middleboxes may enjoy less integrity protection than that produced by endpoints.  In addition, endpoint authentication of middleboxes and vice-versa may be better conducted out-of- band (treating the middlebox as an endpoint for the authentication protocol) than in-band (treating the middlebox as a participant in a 3+ party communication).</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#technical-requirements" id="technical-requirements">Technical Requirements</a></h1>
<p id="rfc.section.7.p.1">The following requirements detail the constraints on how the SPUD facility must meet its functional requirements.</p>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> <a href="#middlebox-traversal" id="middlebox-traversal">Middlebox Traversal</a></h1>
<p id="rfc.section.7.1.p.1">SPUD, including all path-to-endpoint and endpoint-to-path signaling as well as superstrate and superstrate payload, should be able to traverse existing middleboxes and firewalls, including those that are not SPUD-aware. Therefore SPUD must be encapsulated in a transport protocol that is known to be accepted on a large fraction of paths in the Internet, or implement some form of probing to determine in advance which transport protocols will be accepted on a certain path. This encapsulation will require port numbers to support endpoints connected via network address and port translation (NAPT). We note that UDP encapsulation would meet these requirements.</p>
<h1 id="rfc.section.7.2"><a href="#rfc.section.7.2">7.2.</a> <a href="#low-overhead-in-network-processing" id="low-overhead-in-network-processing">Low Overhead in Network Processing</a></h1>
<p id="rfc.section.7.2.p.1">SPUD must be desgined to have low overhead, specifically requiring very little effort to recognize that a packet is a SPUD packet and to determine the tube it is associated with. We note that a magic number as in<br/> <a href="#protection-against-trivial-abuse">Section 6.6</a> would also have a low probability of colliding with any non-SPUD traffic, therefore meeting the recognition requirement. Tube identifiers appearing directly in the encapsulation-layer header would meet the tube association requirement.</p>
<h1 id="rfc.section.7.3"><a href="#rfc.section.7.3">7.3.</a> <a href="#implementability-in-user-space" id="implementability-in-user-space">Implementability in User-Space</a></h1>
<p id="rfc.section.7.3.p.1">To enable fast deployment SPUD and superstrates must be implementable without requiring kernel replacements or modules on the endpoints, and without having special privilege (such as is required for raw packet transmission, i.e. root or &#8220;jailbreak&#8221;) on the endpoints.</p>
<p id="rfc.section.7.3.p.2">We note here that UDP would meet this requirement, as nearly all operating systems and application development platforms allow a userspace application to open UDP sockets.</p>
<p id="rfc.section.7.3.p.3">We additionally note that while TCP APIs are also widely available to userspace applications, they are bound to TCP transport semantics, and generally do not provide enough control over segmentation and transmission to successfully implement superstrate transports.</p>
<h1 id="rfc.section.7.4"><a href="#rfc.section.7.4">7.4.</a> <a href="#incremental-deployability" id="incremental-deployability">Incremental Deployability</a></h1>
<p id="rfc.section.7.4.p.1">SPUD must be designed to operate in the present Internet, and must be designed to encourage incremental deployment.</p>
<p id="rfc.section.7.4.p.2">As endpoint implementations can change more quickly than middleboxes can be designed and deployed, a SPUD facility that was be useful between endpoints even before the deployment of middleboxes that understand it would stimulate deployment. The information exposed over SPUD must provide incentives for adoption by both endpoints and middleboxes.</p>
<p id="rfc.section.7.4.p.3">SPUD must not be designed in such a way that precludes its deployability in multipath, multicast, and/or endpoint multi-homing environments.</p>
<h1 id="rfc.section.7.5"><a href="#rfc.section.7.5">7.5.</a> <a href="#no-unnecessary-restrictions-on-the-superstrate" id="no-unnecessary-restrictions-on-the-superstrate">No unnecessary restrictions on the superstrate</a></h1>
<p id="rfc.section.7.5.p.1">Beyond those restrictions deemed necessary as common features of any secure, responsible transport protocol (see <a href="#protection-against-trivial-abuse">Section 6.6</a>), SPUD must impose only minimal restrictions on the transport protocols it encapsulates. However, to serve as a substrate, it is necessary to factor out the information that middleboxes commonly rely on and endpoints are commonly willing to expose. This information should be included in SPUD, and might itself impose additional restrictions to the superstrate.</p>
<h1 id="rfc.section.7.6"><a href="#rfc.section.7.6">7.6.</a> <a href="#minimal-additional-start-up-latency" id="minimal-additional-start-up-latency">Minimal additional start-up latency</a></h1>
<p id="rfc.section.7.6.p.1">SPUD should not introduce additional start-up latency for superstrates.  Specifically, superstrates which can send data on an initial packet must be able to do so when encapsulated within SPUD.</p>
<h1 id="rfc.section.7.7"><a href="#rfc.section.7.7">7.7.</a> <a href="#minimal-header-overhead" id="minimal-header-overhead">Minimal header overhead</a></h1>
<p id="rfc.section.7.7.p.1">To avoid reducing network performance, the information and coding used in SPUD should be designed to use the minimum necessary amount of additional space in encapsulation headers.</p>
<h1 id="rfc.section.7.8"><a href="#rfc.section.7.8">7.8.</a> <a href="#minimal-non-productive-traffic" id="minimal-non-productive-traffic">Minimal non-productive traffic</a></h1>
<p id="rfc.section.7.8.p.1">SPUD should minimize additional non-productive traffic (e.g. keepalives), and should provide mechanisms to allow its superstrates to minimize their reliance on non-productive traffic.</p>
<h1 id="rfc.section.7.9"><a href="#rfc.section.7.9">7.9.</a> <a href="#endpoint-control" id="endpoint-control">Endpoint Control</a></h1>
<p id="rfc.section.7.9.p.1">Both endpoint-to-path and path-to-endpoint signaling happen completely under endpoint control.</p>
<h1 id="rfc.section.7.10"><a href="#rfc.section.7.10">7.10.</a> <a href="#on-reliability-fragmentation-mtu-and-duplication" id="on-reliability-fragmentation-mtu-and-duplication">On Reliability, Fragmentation, MTU, and Duplication</a></h1>
<p id="rfc.section.7.10.p.1">As any information provided by SPUD is anyway opportunistic, SPUD need not provide reliable signaling for the information associated with a tube. Signals must be idempotent; all middleboxes and endpoints must gracefully handle receiving duplicate signal information. SPUD must continue working in the presence of IPv4 fragmentation on path, but in order to reduce the impact of requiring fragments reassembly at middleboxes for signals to be intelligible, endpoints using SPUD should attempt to fit all signals into single MTU-sized packets.</p>
<p id="rfc.section.7.10.p.2">Given the importance of good path MTU information to SPUD&#8217;s own signaling, SPUD should implement packetization layer path MTU discovery <a href="#RFC4821">[RFC4821]</a>.</p>
<p id="rfc.section.7.10.p.3">Any facilities requiring more than an MTU&#8217;s worth of data in a single signal should use an out-of-band method which does provide reliability &#8211; this method may be an existing transport or superstrate/SPUD combination, or a &#8220;minimal transport&#8221; defined by SPUD for its own use.</p>
<h1 id="rfc.section.7.11"><a href="#rfc.section.7.11">7.11.</a> <a href="#spud-support-discovery" id="spud-support-discovery">SPUD Support Discovery</a></h1>
<p id="rfc.section.7.11.p.1">If SPUD is not usable on a path to an endpoint, a SPUD sender needs to be able to fall back to some other approach to achieve the goals of the superstrate; a SPUD endpoint must be able to easily determine whether a remote endpoint with which it wants to communicate using SPUD as a substrate can support SPUD, and whether path to the remote endpoint as well as the return path from the remote endpoint will pass SPUD packets.</p>
<p id="rfc.section.7.11.p.2">It is not clear whether this is a requirement of SPUD, or a requirement of the superstrate / application over SPUD.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a></h1>
<p id="rfc.section.8.p.1">The security-relevant requirements for SPUD are outlined in <a href="#security-requirements">Section 6</a>.  These will be further addressed in protocol definition work following from these requirements.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a></h1>
<p id="rfc.section.9.p.1">This document has no actions for IANA.</p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#contributors" id="contributors">Contributors</a></h1>
<p id="rfc.section.10.p.1">In addition to the editors, this document is the work of David Black, Ken Calvert, Ted Hardie, Joe Hildebrand, Jana Iyengar, and Eric Rescorla.</p>
<h1 id="rfc.section.11"><a href="#rfc.section.11">11.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.11.p.1">Thanks to Ozgu Alay, Roland Bless, Cameron Byrne, Toerless Eckert, Gorry Fairhurst, Daniel Kahn Gillmor, Tom Herbert, Christian Huitema, Iain Learmonth, Diego Lopez, and Matteo Varvello for feedback and comments on these requirements, as well as to the participants at the SPUD BoF at IETF 92 meeting in Dallas and the IAB SEMI workshop in Zurich for the discussions leading to this work.</p>
<p id="rfc.section.11.p.2">This work is supported by the European Commission under Horizon 2020 grant agreement no. 688421 Measurement and Architecture for a Middleboxed Internet (MAMI), and by the Swiss State Secretariat for Education, Research, and Innovation under contract no. 15.0268. This support does not imply endorsement.</p>
<h1 id="rfc.references"><a href="#rfc.references">12.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC0792">[RFC0792]</b>
      </td>
      <td class="top"><a>Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc792">Internet Control Message Protocol</a>", STD 5, RFC 792, DOI 10.17487/RFC0792, September 1981.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2827">[RFC2827]</b>
      </td>
      <td class="top"><a>Ferguson, P.</a> and <a>D. Senie</a>, "<a href="http://tools.ietf.org/html/rfc2827">Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing</a>", BCP 38, RFC 2827, DOI 10.17487/RFC2827, May 2000.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3234">[RFC3234]</b>
      </td>
      <td class="top"><a>Carpenter, B.</a> and <a>S. Brim</a>, "<a href="http://tools.ietf.org/html/rfc3234">Middleboxes: Taxonomy and Issues</a>", RFC 3234, DOI 10.17487/RFC3234, February 2002.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4122">[RFC4122]</b>
      </td>
      <td class="top"><a>Leach, P.</a>, <a>Mealling, M.</a> and <a>R. Salz</a>, "<a href="http://tools.ietf.org/html/rfc4122">A Universally Unique IDentifier (UUID) URN Namespace</a>", RFC 4122, DOI 10.17487/RFC4122, July 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4443">[RFC4443]</b>
      </td>
      <td class="top"><a>Conta, A.</a>, <a>Deering, S.</a> and <a>M. Gupta</a>, "<a href="http://tools.ietf.org/html/rfc4443">Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification</a>", RFC 4443, DOI 10.17487/RFC4443, March 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4821">[RFC4821]</b>
      </td>
      <td class="top"><a>Mathis, M.</a> and <a>J. Heffner</a>, "<a href="http://tools.ietf.org/html/rfc4821">Packetization Layer Path MTU Discovery</a>", RFC 4821, DOI 10.17487/RFC4821, March 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5226">[RFC5226]</b>
      </td>
      <td class="top"><a>Narten, T.</a> and <a>H. Alvestrand</a>, "<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 5226, DOI 10.17487/RFC5226, May 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6347">[RFC6347]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a> and <a>N. Modadugu</a>, "<a href="http://tools.ietf.org/html/rfc6347">Datagram Transport Layer Security Version 1.2</a>", RFC 6347, DOI 10.17487/RFC6347, January 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7510">[RFC7510]</b>
      </td>
      <td class="top"><a>Xu, X.</a>, <a>Sheth, N.</a>, <a>Yong, L.</a>, <a>Callon, R.</a> and <a>D. Black</a>, "<a href="http://tools.ietf.org/html/rfc7510">Encapsulating MPLS in UDP</a>", RFC 7510, DOI 10.17487/RFC7510, April 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7663">[RFC7663]</b>
      </td>
      <td class="top"><a>Trammell, B.</a> and <a>M. Kuehlewind</a>, "<a href="http://tools.ietf.org/html/rfc7663">Report from the IAB Workshop on Stack Evolution in a Middlebox Internet (SEMI)</a>", RFC 7663, DOI 10.17487/RFC7663, October 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-tsvwg-rfc5405bis">[I-D.ietf-tsvwg-rfc5405bis]</b>
      </td>
      <td class="top"><a>Eggert, L.</a>, <a>Fairhurst, G.</a> and <a>G. Shepherd</a>, "<a href="http://tools.ietf.org/html/draft-ietf-tsvwg-rfc5405bis-11">UDP Usage Guidelines</a>", Internet-Draft draft-ietf-tsvwg-rfc5405bis-11, April 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.kuehlewind-spud-use-cases">[I-D.kuehlewind-spud-use-cases]</b>
      </td>
      <td class="top"><a>K&#258;&#378;hlewind, M.</a> and <a>B. Trammell</a>, "<a href="http://tools.ietf.org/html/draft-kuehlewind-spud-use-cases-01">Use Cases for a Substrate Protocol for User Datagrams (SPUD)</a>", Internet-Draft draft-kuehlewind-spud-use-cases-01, March 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.huitema-tls-dtls-as-subtransport">[I-D.huitema-tls-dtls-as-subtransport]</b>
      </td>
      <td class="top"><a>Huitema, C.</a>, <a>Rescorla, E.</a> and <a>J. Jana</a>, "<a href="http://tools.ietf.org/html/draft-huitema-tls-dtls-as-subtransport-00">DTLS as Subtransport protocol</a>", Internet-Draft draft-huitema-tls-dtls-as-subtransport-00, March 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.trammell-stackevo-explicit-coop">[I-D.trammell-stackevo-explicit-coop]</b>
      </td>
      <td class="top"><a>Trammell, B.</a>, "<a href="http://tools.ietf.org/html/draft-trammell-stackevo-explicit-coop-00">Architectural Considerations for Transport Evolution with Explicit Path Cooperation</a>", Internet-Draft draft-trammell-stackevo-explicit-coop-00, September 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Trammell</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Trammell</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  <span class="vcardline">Gloriastrasse 35</span>

	  <span class="vcardline">
		<span class="locality">8092 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ietf@trammell.ch">ietf@trammell.ch</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mirja Kuehlewind</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Kuehlewind</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  <span class="vcardline">Gloriastrasse 35</span>

	  <span class="vcardline">
		<span class="locality">8092 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mirja.kuehlewind@tik.ee.ethz.ch">mirja.kuehlewind@tik.ee.ethz.ch</a></span>

  </address>
</div>

</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Requirements for the design of a Substrate Protocol for User Datagrams (SPUD)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>
<style type="text/css">
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}

@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

body {
  font: 11pt cambria, helvetica, arial, sans-serif;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 1em auto;
  max-width: 700px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: candara, helvetica, arial, sans-serif;
  font-size-adjust: 0.5;
}
.title { font-size: 150%; }
h1 { font-size: 130%; }
h2 { font-size: 120%; }
h3, h4 { font-size: 110%; }

table {
  margin-left: 0em;
}
table.header {
  width: 100%;
}

table.header td {
  background-color: inherit;
  color: black;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}

pre.text, pre.text2 {
  width: 90%;
}

dt {
  float: left; clear: left;
  margin: 0.5em 0.5em 0 0;
}
dt:first-child {
  margin-top: 0;
}
dd {
  margin: 0.5em 0 0 2em;
}
dd p, dd ul {
  margin-top: 0; margin-bottom: 0;
}
dd *+p {
  margin-top: 0.5em;
}

ol, ul {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
ul.toc, ul.toc ul {
  margin: 0 0 0 1.5em;
}
ul.toc a:first-child {
  display: inline-block;
  min-width: 1.2em;
}
</style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Motivation"/>
<link href="#rfc.section.2" rel="Chapter" title="2 History"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Terminology"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Use Cases"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Functional Requirements"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Grouping of Packets (into &#x201C;tubes&#x201D;)"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Endpoint to Path Signaling"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Path to Endpoint Signaling"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Tube Start and End Signaling"/>
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Extensibility"/>
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 Authentication"/>
<link href="#rfc.section.5.7" rel="Chapter" title="5.7 Proof of topology"/>
<link href="#rfc.section.5.8" rel="Chapter" title="5.8 Integrity"/>
<link href="#rfc.section.5.9" rel="Chapter" title="5.9 Privacy"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Technical Requirements"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Middlebox Traversal"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Low Overhead in Network Processing"/>
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Implementability in User-Space"/>
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Incremental Deployability in an Untrusted, Unreliable Environment"/>
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 Protection against trivial abuse"/>
<link href="#rfc.section.6.6" rel="Chapter" title="6.6 No unnecessary restrictions on the superstrate"/>
<link href="#rfc.section.6.7" rel="Chapter" title="6.7 Minimal additional start-up latency"/>
<link href="#rfc.section.6.8" rel="Chapter" title="6.8 Minimal Header Overhead"/>
<link href="#rfc.section.6.9" rel="Chapter" title="6.9 Minimal non-productive traffic"/>
<link href="#rfc.section.6.10" rel="Chapter" title="6.10 Invariance of Security Semantics"/>
<link href="#rfc.section.6.11" rel="Chapter" title="6.11 Reliability, Fragmentation, and Duplication"/>
<link href="#rfc.section.6.12" rel="Chapter" title="6.12 Interoperability with non-encapsulated superstrates"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Open questions and discussion"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Tradeoffs in tube identifiers"/>
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Property binding"/>
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Tradeoffs in integrity protection"/>
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 In-band, out-of-band, piggybacked, and interleaved signaling"/>
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 Continuum of trust among endpoints and middleboxes"/>
<link href="#rfc.section.7.6" rel="Chapter" title="7.6 Discovery and capability exposure"/>
<link href="#rfc.section.7.7" rel="Chapter" title="7.7 Hard state vs. soft state"/>
<link href="#rfc.section.7.8" rel="Chapter" title="7.8 Tube vs. superstrate association lifetime"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations"/>
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 Contributors"/>
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgments"/>
<link href="#rfc.references" rel="Chapter" title="12 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.8 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Trammell, B., Ed. and M. Kuehlewind, Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-trammell-spud-req-01" />
  <meta name="dct.issued" scheme="ISO8601" content="2015-10-19" />
  <meta name="dct.abstract" content="The Substrate Protocol for User Datagrams (SPUD) BoF session at the IETF 92 meeting in Dallas in March 2015 identified the potential need for a UDP-based encapsulation protocol to allow explicit cooperation with middleboxes while using new, encrypted transport protocols. This document proposes an initial set of requirements for such a protocol, and discusses tradeoffs to be made in further refining these requirements." />
  <meta name="description" content="The Substrate Protocol for User Datagrams (SPUD) BoF session at the IETF 92 meeting in Dallas in March 2015 identified the potential need for a UDP-based encapsulation protocol to allow explicit cooperation with middleboxes while using new, encrypted transport protocols. This document proposes an initial set of requirements for such a protocol, and discusses tradeoffs to be made in further refining these requirements." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">B. Trammell, Ed.</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">M. Kuehlewind, Ed.</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">ETH Zurich</td>
</tr>
<tr>
  <td class="left">Expires: April 21, 2016</td>
  <td class="right">October 19, 2015</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Requirements for the design of a Substrate Protocol for User Datagrams (SPUD)<br />
  <span class="filename">draft-trammell-spud-req-01</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>The Substrate Protocol for User Datagrams (SPUD) BoF session at the IETF 92 meeting in Dallas in March 2015 identified the potential need for a UDP-based encapsulation protocol to allow explicit cooperation with middleboxes while using new, encrypted transport protocols. This document proposes an initial set of requirements for such a protocol, and discusses tradeoffs to be made in further refining these requirements.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 21, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2015 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Motivation</a></li>
<li>2.   <a href="#rfc.section.2">History</a></li>
<li>3.   <a href="#rfc.section.3">Terminology</a></li>
<li>4.   <a href="#rfc.section.4">Use Cases</a></li>
<li>5.   <a href="#rfc.section.5">Functional Requirements</a></li>
<li>5.1.   <a href="#rfc.section.5.1">Grouping of Packets (into &#8220;tubes&#8221;)</a></li>
<li>5.2.   <a href="#rfc.section.5.2">Endpoint to Path Signaling</a></li>
<li>5.3.   <a href="#rfc.section.5.3">Path to Endpoint Signaling</a></li>
<li>5.4.   <a href="#rfc.section.5.4">Tube Start and End Signaling</a></li>
<li>5.5.   <a href="#rfc.section.5.5">Extensibility</a></li>
<li>5.6.   <a href="#rfc.section.5.6">Authentication</a></li>
<li>5.7.   <a href="#rfc.section.5.7">Proof of topology</a></li>
<li>5.8.   <a href="#rfc.section.5.8">Integrity</a></li>
<li>5.9.   <a href="#rfc.section.5.9">Privacy</a></li>
<li>6.   <a href="#rfc.section.6">Technical Requirements</a></li>
<li>6.1.   <a href="#rfc.section.6.1">Middlebox Traversal</a></li>
<li>6.2.   <a href="#rfc.section.6.2">Low Overhead in Network Processing</a></li>
<li>6.3.   <a href="#rfc.section.6.3">Implementability in User-Space</a></li>
<li>6.4.   <a href="#rfc.section.6.4">Incremental Deployability in an Untrusted, Unreliable Environment</a></li>
<li>6.5.   <a href="#rfc.section.6.5">Protection against trivial abuse</a></li>
<li>6.6.   <a href="#rfc.section.6.6">No unnecessary restrictions on the superstrate</a></li>
<li>6.7.   <a href="#rfc.section.6.7">Minimal additional start-up latency</a></li>
<li>6.8.   <a href="#rfc.section.6.8">Minimal Header Overhead</a></li>
<li>6.9.   <a href="#rfc.section.6.9">Minimal non-productive traffic</a></li>
<li>6.10.   <a href="#rfc.section.6.10">Invariance of Security Semantics</a></li>
<li>6.11.   <a href="#rfc.section.6.11">Reliability, Fragmentation, and Duplication</a></li>
<li>6.12.   <a href="#rfc.section.6.12">Interoperability with non-encapsulated superstrates</a></li>
<li>7.   <a href="#rfc.section.7">Open questions and discussion</a></li>
<li>7.1.   <a href="#rfc.section.7.1">Tradeoffs in tube identifiers</a></li>
<li>7.2.   <a href="#rfc.section.7.2">Property binding</a></li>
<li>7.3.   <a href="#rfc.section.7.3">Tradeoffs in integrity protection</a></li>
<li>7.4.   <a href="#rfc.section.7.4">In-band, out-of-band, piggybacked, and interleaved signaling</a></li>
<li>7.5.   <a href="#rfc.section.7.5">Continuum of trust among endpoints and middleboxes</a></li>
<li>7.6.   <a href="#rfc.section.7.6">Discovery and capability exposure</a></li>
<li>7.7.   <a href="#rfc.section.7.7">Hard state vs. soft state</a></li>
<li>7.8.   <a href="#rfc.section.7.8">Tube vs. superstrate association lifetime</a></li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a></li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a></li>
<li>10.   <a href="#rfc.section.10">Contributors</a></li>
<li>11.   <a href="#rfc.section.11">Acknowledgments</a></li>
<li>12.   <a href="#rfc.references">Informative References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#motivation" id="motivation">Motivation</a></h1>
<p id="rfc.section.1.p.1">A number of efforts to create new transport protocols or experiment with new network behaviors have been built on top of UDP, as it traverses firewalls and other middleboxes more readily than new protocols do.  Each such effort must, however, either manage its flows within common middlebox assumptions for UDP or train the middleboxes on the new protocol (thus losing the benefit of using UDP). A common Substrate Protocol for User Datagrams (SPUD) would allow each effort to re-use a set of shared methods for notifying middleboxes of the flows&#8217; semantics, thus avoiding both the limitations of current flow semantics and the need to re-invent the mechanism for notifying the middlebox of the new semantics.</p>
<p id="rfc.section.1.p.2">As a concrete example, it is common for some middleboxes to tear down required state (such as NAT bindings) very rapidly for UDP flows. By notifying the path that a particular transport using UDP maintains session state and explicitly signals session start and stop using the substrate, the using protocol may reduce or avoid the need for heartbeat traffic.</p>
<p id="rfc.section.1.p.3">This document defines a specific set of requirements for a SPUD facility, based on analysis on a target set of applications to be developed on SPUD developing experience with a prototype described in <a href="#I-D.hildebrand-spud-prototype">[I-D.hildebrand-spud-prototype]</a>. It is intended as the basis for determining the next steps to make progress in this space, including eventually chartering an working group for specific protocol engineering work.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#history" id="history">History</a></h1>
<p id="rfc.section.2.p.1">An outcome of the IAB workshop on Stack Evolution in a Middlebox Internet (SEMI) <a href="#I-D.iab-semi-report">[I-D.iab-semi-report]</a>, held in Zurich in January 2015, was a discussion on the creation of a substrate protocol to support the deployment of new transport protocols in the Internet. Assuming that a way forward for transport evolution in user space would involve encapsulation in UDP datagrams, the workshop noted that it may be useful to have a facility built atop UDP to provide minimal signaling of the semantics of a flow that would otherwise be available in TCP. At the very least, indications of first and last packets in a flow may assist firewalls and NATs in policy decision and state maintenance. Further transport semantics would be used by the protocol running atop this facility, but would only be visible to the endpoints, as the transport protocol headers themselves would be encrypted, along with the payload, to prevent inspection or modification.  This encryption might be accomplished by using DTLS <a href="#RFC6347">[RFC6347]</a> as a subtransport <a href="#I-D.huitema-tls-dtls-as-subtransport">[I-D.huitema-tls-dtls-as-subtransport]</a> or by other suitable methods. This facility could also provide minimal application-to-path and path-to-application signaling, though there was less agreement about what should or could be signaled here.</p>
<p id="rfc.section.2.p.2">The Substrate Protocol for User Datagrams (SPUD) BoF was held at IETF 92 in Dallas in March 2015 to develop this concept further. It is clear from discussion before and during the SPUD BoF that any selective exposure of traffic metadata outside a relatively restricted trust domain must be advisory, non-negotiated, and declarative rather than imperative. This conclusion matches experience with previous endpoint-to-middle and middle-to-endpoint signaling approaches. As with other metadata systems, exposure of specific elements must be carefully assessed for privacy risks and the total of exposed elements must be so assessed.  Each exposed parameter should also be independently verifiable, so that each entity can assign its own trust to other entities. Basic transport over the substrate must continue working even if signaling is ignored or stripped, to support incremental deployment. These restrictions on vocabulary are discussed further in <a href="#stackevo-explicit-coop">[stackevo-explicit-coop]</a>. This discussion includes privacy and trust concerns as well as the need for strong incentives for middlebox cooperation based on the information that are exposed.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.3.p.1">This document uses the following terms:</p>
<p/>

<ul>
  <li>
    <dl>
      <dt>Superstrate: </dt>
      <dd style="margin-left: 8">The transport protocol or protocol stack &#8220;above&#8221; SPUD, that uses SPUD for explicit path cooperation and path traversal. The superstrate usually consists of a security layer (e.g. TLS, DTLS) and a transport protocol, or a transport protocol with integrated security features, to protect headers and payload above SPUD.</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>Endpoint: </dt>
      <dd style="margin-left: 8">A node that sends or receives a packet. In this document, this term may refer to either the SPUD implementation on this node, the superstrate implementation on this node, or the applications running over that superstrate.</dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>Path: </dt>
      <dd style="margin-left: 8">The sequence of Internet Protocol nodes and links that a given packet traverses from endpoint to endpoint. </dd>
    </dl>
  </li>
  <li>
    <dl>
      <dt>Middlebox: </dt>
      <dd style="margin-left: 8">A device on the path that makes decisions about forwarding behavior based on other than IP or sub-IP addressing information, and/or that modifies the packet before forwarding.</dd>
    </dl>
  </li>
</ul>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#use-cases" id="use-cases">Use Cases</a></h1>
<p id="rfc.section.4.p.1">The primary use case for endpoint to path signaling, making use of packet grouping, is the binding of limited related semantics (start-tube and stop-tube) to a group of packets which are semantically related in terms of the application or superstrate. By explicitly signaling start and stop semantics, a flow allows middleboxes to use those signals for setting up and tearing down their relevant state (NAT bindings, firewall pinholes), rather than requiring the middlebox to infer this state from continued traffic. At best, this would allow the application to refrain from sending heartbeat traffic, which might result in reduced radio utilization (and thus greater battery life) on mobile platforms.</p>
<p id="rfc.section.4.p.2">SPUD may also provide some facility for SPUD-aware nodes on the path to signal some property of the path relative to a tube to the endpoints and other SPUD-aware nodes on the path. The primary use case for path to application signaling is parallel to the use of ICMP <a href="#RFC0792">[RFC0792]</a>, in that it describes a set of conditions (including errors) that applies to the datagrams as they traverse the path. This usage is, however, not a pure replacement for ICMP but a &#8220;5-tuple ICMP&#8221; which would traverse NATs in the same way as the traffic related to it, and be deliverable to the application with appropriate tube information.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#functional-requirements" id="functional-requirements">Functional Requirements</a></h1>
<p id="rfc.section.5.p.1">The following requirements detail the services that SPUD must provide to superstrates, endpoints, and middleboxes using SPUD.</p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#grouping-of-packets-into-tubes" id="grouping-of-packets-into-tubes">Grouping of Packets (into &#8220;tubes&#8221;)</a></h1>
<p id="rfc.section.5.1.p.1">Transport semantics and many properties of communication that endpoints may want to expose to middleboxes are bound to flows or groups of flows (five- tuples). SPUD must therefore provide a basic facility for associating packets together (into what we call a &#8220;tube&#8221;, for lack of a better term) and associate information to these groups of packets. Each packet in a SPUD &#8220;flow&#8221; (determined by 5-tuple) belongs to exactly one tube. Notionally, a tube consists of a set of packets with a set of common properties, that should therefore receive equivalent treatment from the network; these tubes may or may not be related to separate semantic entities in the superstrate (e.g. SCTP streams).</p>
<p id="rfc.section.5.1.p.2">The simplest mechanisms for association involve the addition of an identifier to each packet in a tube. Current thoughts on the tradeoffs on requirements and constraints on this identifier space are given in {{tradeoffs-in-tube- identifiers}}.</p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#endpoint-to-path-signaling" id="endpoint-to-path-signaling">Endpoint to Path Signaling</a></h1>
<p id="rfc.section.5.2.p.1">SPUD must be able to provide information scoped to a tube from the end- point(s) to all SPUD-aware nodes on the path about the packets in that tube.  Since it is implausible that an endpoint has pre-existing trust relationships to all SPUD-aware middleboxes on a certain path in the context of the Internet, SPUD must provide in-band signaling. SPUD may in addition also offer mechanisms for out-of-band signaling when appropriate. See {{in-band-out-of- band-piggybacked-and-interleaved-signaling}} for more discussion.</p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> <a href="#path-to-endpoint-signaling" id="path-to-endpoint-signaling">Path to Endpoint Signaling</a></h1>
<p id="rfc.section.5.3.p.1">SPUD must be able to provide information from a SPUD-aware middlebox to the endpoint. Though this information is not scoped to a tube in the same way that endpoint to path signaling is, as the middleboxes do not originate the packets in a tube, it is still associated with a tube, in terms of &#8220;the properties of the path(s) this tube will traverse&#8221;. Path to endpoint signaling need not be in-band; see <a href="#in-band-out-of-band-piggybacked-and-interleaved-signaling">Section 7.4</a> for more discussion.</p>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> <a href="#tube-start-and-end-signaling" id="tube-start-and-end-signaling">Tube Start and End Signaling</a></h1>
<p id="rfc.section.5.4.p.1">SPUD must provide a facility for endpoints to signal that a tube has started, that the start of the tube has been acknowledged and accepted by the remote endpoint(s), and that a tube has ended and its state can be forgotten by the path. Given unreliable signaling (see <a href="#reliability-fragmentation-and-duplication">Section 6.11</a>) both endpoints and devices on the path must be resilient to the loss of any of these signals. Specifically, timeouts are still necessary to clean up stale state. See <a href="#hard-state-vs-soft-state">Section 7.7</a> and <a href="#tube-vs-superstrate-association-lifetime">Section 7.8</a> for more discussion on tube start and end signaling.</p>
<h1 id="rfc.section.5.5"><a href="#rfc.section.5.5">5.5.</a> <a href="#extensibility" id="extensibility">Extensibility</a></h1>
<p id="rfc.section.5.5.p.1">SPUD must enable multiple new transport semantics and application/path declarations without requiring updates to SPUD implementations in middleboxes.</p>
<h1 id="rfc.section.5.6"><a href="#rfc.section.5.6">5.6.</a> <a href="#authentication" id="authentication">Authentication</a></h1>
<p id="rfc.section.5.6.p.1">The basic SPUD protocol must not require any authentication or a priori trust relationship between endpoints and middleboxes to function.  However, SPUD should support the presentation/exchange of authentication information in environments where a trust relationship already exists, or can be easily established, either in-band or out-of-band.</p>
<h1 id="rfc.section.5.7"><a href="#rfc.section.5.7">5.7.</a> <a href="#proof-of-topology" id="proof-of-topology">Proof of topology</a></h1>
<p id="rfc.section.5.7.p.1">Devices may make assertions of network characteristics relevant to a flow. One way these assertions can be assessed is by a demonstration that the device making it is on-path to the flow and so could adjust the characteristics to match the assertion.  SPUD must therefore allow endpoints to distinguish on- path devices from devices not on the path. Network elements may also need to confirm that application-to-path assertions are made by the source indicated in the flow.  In both cases, return routability (as in {{protection-against- trivial-abuse}}) may offer one incrementally deployable method of testing the topology to make this confirmation.</p>
<h1 id="rfc.section.5.8"><a href="#rfc.section.5.8">5.8.</a> <a href="#integrity" id="integrity">Integrity</a></h1>
<p id="rfc.section.5.8.p.1">SPUD must provide integrity protection of SPUD-encapsulated packets, though the details of this integrity protection are still open; see {{tradeoffs-in- integrity-protection}}. Endpoints should be able to detect changes to headers SPUD uses for its own signaling (whether due to error, accidental modification, or malicious modification), as well as the injection of packets into a SPUD flow (defined by 5-tuple) or tube by nodes other than the remote endpoint. Integrity protection of the superstrate is left up to the superstrate.</p>
<h1 id="rfc.section.5.9"><a href="#rfc.section.5.9">5.9.</a> <a href="#privacy" id="privacy">Privacy</a></h1>
<p id="rfc.section.5.9.p.1">SPUD must allow endpoints to control the amount of information exposed to middleboxes, with the default being the minimum necessary for correct functioning.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#technical-requirements" id="technical-requirements">Technical Requirements</a></h1>
<p id="rfc.section.6.p.1">The following requirements detail the constraints on how the SPUD facility must meet its functional requirements.</p>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> <a href="#middlebox-traversal" id="middlebox-traversal">Middlebox Traversal</a></h1>
<p id="rfc.section.6.1.p.1">SPUD must be able to traverse middleboxes that are not SPUD-aware. Therefore SPUD must be encapsulated in a transport protocol that is known to be accepted on a large fraction of paths in the Internet, or implement some form of probing to determine in advance which transport protocols will be accepted on a certain path. This encapsulation will require port numbers to support NAPT- connected endpoints. This indicates UDP encapsulation.</p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> <a href="#low-overhead-in-network-processing" id="low-overhead-in-network-processing">Low Overhead in Network Processing</a></h1>
<p id="rfc.section.6.2.p.1">SPUD must be low-overhead, specifically requiring very little effort to recognize that a packet is a SPUD packet and to determine the tube it is associated with.</p>
<h1 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3.</a> <a href="#implementability-in-user-space" id="implementability-in-user-space">Implementability in User-Space</a></h1>
<p id="rfc.section.6.3.p.1">To enable fast deployment SPUD and superstrates must be implementable without requiring kernel replacements or modules on the endpoints, and without having special privilege (root or &#8220;jailbreak&#8221;) on the endpoints. Usually all operating systems will allow a user to open a UDP socket. This indicates UDP- based encapsulation, either exclusively or as a mandatory-to-implement feature.</p>
<h1 id="rfc.section.6.4"><a href="#rfc.section.6.4">6.4.</a> <a href="#incremental-deployability-in-an-untrusted-unreliable-environment" id="incremental-deployability-in-an-untrusted-unreliable-environment">Incremental Deployability in an Untrusted, Unreliable Environment</a></h1>
<p id="rfc.section.6.4.p.1">SPUD must operate in the present Internet. In order to maximize deployment, it should also be useful as an encapsulation between endpoints even before the deployment of middleboxes that understand it. The information exposed over SPUD must provide incentives for adoption by both endpoints and middleboxes, and must maximize privacy (by minimizing information exposed). Further, SPUD must be robust to packet loss, duplication and reordering by the underlying network service.  SPUD must work in multipath, multicast, and endpoint multi- homing environments.</p>
<p id="rfc.section.6.4.p.2">Incremental deployability likely requires limitations of the vocabulary used in signaling, to ensure that each actor in a nontrusted environment has incentives to participate in the signaling protocol honestly; see {{stackevo- explicit-coop}} for more.</p>
<h1 id="rfc.section.6.5"><a href="#rfc.section.6.5">6.5.</a> <a href="#protection-against-trivial-abuse" id="protection-against-trivial-abuse">Protection against trivial abuse</a></h1>
<p id="rfc.section.6.5.p.1">Especially if it is encapsulated over UDP, where there is a good deal of malicious background traffic (reflection, amplification, and state exhaustion attacks, and other exploits of packet spoofing), due to the ease of forging source addresses in UDP together with the only limited deployment of network egress filtering <a href="#RFC2827">[RFC2827]</a>. SPUD must provide minimal protection against such trivial abuse. This probably implies that SPUD requires:</p>
<p/>

<ul>
  <li>a proof of return routability,</li>
  <li>the presence of a feedback channel between endpoints,</li>
  <li>a method to probabilistically discriminiate legitimate SPUD traffic from reflected malicious traffic, and</li>
  <li>mechanisms to protect against state exhaustion and other denial-of-service attacks.</li>
</ul>
<p id="rfc.section.6.5.p.3">We note that return routability excludes use of a UDP source port that does not accept traffic (i.e., for one-way communication, as is commonly done for unidirectional UDP tunnels, e.g., MPLS in UDP <a href="#RFC7510">[RFC7510]</a> as an entropy input.</p>
<h1 id="rfc.section.6.6"><a href="#rfc.section.6.6">6.6.</a> <a href="#no-unnecessary-restrictions-on-the-superstrate" id="no-unnecessary-restrictions-on-the-superstrate">No unnecessary restrictions on the superstrate</a></h1>
<p id="rfc.section.6.6.p.1">Beyond those restrictions deemed necessary as common features of any secure, responsible transport protocol (see <a href="#protection-against-trivial-abuse">Section 6.5</a>), SPUD must impose minimal restrictions on the transport protocols it encapsulates.  However, to serve as a substrate, it is necessary to factor out the information that middleboxes commonly rely on and endpoints are commonly willing to expose. This information should be included in SPUD, and might itself impose additional restrictions to the superstrate.</p>
<h1 id="rfc.section.6.7"><a href="#rfc.section.6.7">6.7.</a> <a href="#minimal-additional-start-up-latency" id="minimal-additional-start-up-latency">Minimal additional start-up latency</a></h1>
<p id="rfc.section.6.7.p.1">SPUD should not introduce additional start-up latency for superstrates.</p>
<h1 id="rfc.section.6.8"><a href="#rfc.section.6.8">6.8.</a> <a href="#minimal-header-overhead" id="minimal-header-overhead">Minimal Header Overhead</a></h1>
<p id="rfc.section.6.8.p.1">To avoid reducing network performance, the information and coding used in SPUD should be designed to use the minimum necessary amount of additional space in encapsulation headers.</p>
<h1 id="rfc.section.6.9"><a href="#rfc.section.6.9">6.9.</a> <a href="#minimal-non-productive-traffic" id="minimal-non-productive-traffic">Minimal non-productive traffic</a></h1>
<p id="rfc.section.6.9.p.1">SPUD should not introduce additional non-productive traffic (e.g. keepalives), and should provide mechanisms to allow its superstrates to minimize their reliance on non-productive traffic.</p>
<h1 id="rfc.section.6.10"><a href="#rfc.section.6.10">6.10.</a> <a href="#invariance-of-security-semantics" id="invariance-of-security-semantics">Invariance of Security Semantics</a></h1>
<p id="rfc.section.6.10.p.1">The use of SPUD must not change the security semantics of the superstrate.  If the superstrate includes payload encryption for confidentiality, for example, the use of SPUD must not allow deep packet inspection systems to have access to the plaintext.  While a box along the path may indicate a particular flow is adminstratively prohibited or why it is prohibited, SPUD itself must not be used to negotiate the means to lift the prohibition.</p>
<h1 id="rfc.section.6.11"><a href="#rfc.section.6.11">6.11.</a> <a href="#reliability-fragmentation-and-duplication" id="reliability-fragmentation-and-duplication">Reliability, Fragmentation, and Duplication</a></h1>
<p id="rfc.section.6.11.p.1">As any information provided by SPUD is anyway opportunistic, SPUD need not provide reliable signaling for the information associated with a tube. Signals must be idempotent; all middleboxes and endpoints must gracefully handle receiving duplicate signal information. To avoid issues with fragment reassembly, all in-nband SPUD signaling information must fit within a single packet. Any facilities requiring more than an MTU&#8217;s worth of data in a single signal should use an out-of-band method which does provide reliability &#8211; this method may be an existing transport or superstrate/SPUD combination, or a &#8220;minimal transport&#8221; defined by SPUD for its own use.</p>
<h1 id="rfc.section.6.12"><a href="#rfc.section.6.12">6.12.</a> <a href="#interoperability-with-non-encapsulated-superstrates" id="interoperability-with-non-encapsulated-superstrates">Interoperability with non-encapsulated superstrates</a></h1>
<p id="rfc.section.6.12.p.1">It is presumed that &#8220;superstrate X with SPUD&#8221; is a distinct entity on the wire from &#8220;superstrate X&#8221;. The APIs the superstrate presents to the application should be equivalent, and the two wire protocols should be freely transcodeable between each other, with the caveat that the variant without SPUD would not necessarily support features enabling communication with the path. However, there is no requirement that the headers the superstrate uses be the same in the SPUD and non-SPUD variants. Headers that the superstrate chooses always to expose to the path can therefore be encoded in the SPUD layer but not appear in an upper-layer header.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#open-questions-and-discussion" id="open-questions-and-discussion">Open questions and discussion</a></h1>
<p id="rfc.section.7.p.1">The preceding requirements reflect the present best understanding of the authors of the functional and technical requirements on an encapsulation-based protocol for common middlebox-endpoint cooperation for superstrates. There remain a few large open questions and points for discussion, detailed in the subsections below.</p>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> <a href="#tradeoffs-in-tube-identifiers" id="tradeoffs-in-tube-identifiers">Tradeoffs in tube identifiers</a></h1>
<p id="rfc.section.7.1.p.1">Grouping packets into tubes requires some sort of notional tube identifier; for purposes of this discussion we will assume this identifier to be a simple vector of N bits. The properties of the tube identifier are subject to tradeoffs on the requirements for privacy, security, ease of implementation, and header overhead efficiency.</p>
<p id="rfc.section.7.1.p.2">We first assume that the 5-tuple of source and destination IP address, UDP (or other transport protocol) port, and IP protocol identifier (17 for UDP) is used in the Internet as an existing flow identifier, due to the widespread deployment of network address and port translation. The question then arises whether tube identifiers should be scoped to 5-tuples (i.e., a tube is identified by a 6-tuple including the tube identifier) or should be separate, and presumed to be globally unique.</p>
<p id="rfc.section.7.1.p.3">If globally unique, N must be sufficiently large to minimize the probability of collision among multiple tubes having the same identifier along the same path during some period of time. An advantage of globally unique tube identifiers is they allow migration of per-tube state across multiple five- tuples for mobility support in multipath protocols. However, globally unique tube identifiers would also introduce new possibilities for user and node tracking, with a serious negative impact on privacy.</p>
<p id="rfc.section.7.1.p.4">In the case of 5-tuple-scoped identifiers, mobility must be supported separately from the tube identification mechanism. This could be specific to each superstrate (i.e., hidden from the path), or SPUD could provide a general endpoint-to-path tube grouping signal to allow an endpoint to explicitly expose the fact that one tube is related to another to the path.  Even in this case, N must still be sufficiently large, and the bits in the identifier sufficiently random, that possession of a valid tube ID implies that a node can observe packets belonging to the tube. This reduces the chances of success of blind packet injection attacks of packets with guessed valid tube IDs.</p>
<p id="rfc.section.7.1.p.5">When scoped to 5-tuples, the forward and backward directions of a bidirectional flow probably have different tube IDs, since these will necessarily take different paths and may interact with a different set of middleboxes due to asymmetric routing. SPUD will therefore require some facility to note that one tube is the &#8220;reverse&#8221; direction of another, a general case of the tube grouping signal above.</p>
<h1 id="rfc.section.7.2"><a href="#rfc.section.7.2">7.2.</a> <a href="#property-binding" id="property-binding">Property binding</a></h1>
<p id="rfc.section.7.2.p.1">Related to identifier scope is the scope of properties bound to SPUD packets by endpoints. SPUD may support both per-tube properties as well as per-packet properties. Properties signaled per packet reduce state requirements at middleboxes, but also increase per-packet overhead. It is likely that both types of property binding are necessary, but the selection of which properties to bind how must be undertaken carefully. It is also possible that SPUD will provide a very limited set of per-packet signals (such as ECN) using flags in the SPUD header, and require all more complicated properties to be bound per- tube.</p>
<h1 id="rfc.section.7.3"><a href="#rfc.section.7.3">7.3.</a> <a href="#tradeoffs-in-integrity-protection" id="tradeoffs-in-integrity-protection">Tradeoffs in integrity protection</a></h1>
<p id="rfc.section.7.3.p.1">In order to protect the integrity of information carried by SPUD against trivial forging by malicious devices along the path, it is necessary to be able to authenticate the originator of that information. We presume that the authentication of endpoints is a generally desirable property, and to be handled by the superstrate; in this case, SPUD may be able borrow that authentication to protect the integrity of endpoint-originated information. </p>
<p id="rfc.section.7.3.p.2">However, in the Internet, it is not in the general case possible for the endpoint to authenticate every middlebox that might see packets it sends and receives. In this case information produced by middleboxes may enjoy less integrity protection than that produced by endpoints.  In addition, endpoint authentication of middleboxes and vice-versa may be better conducted out-of- band (treating the middlebox as an endpoint for the authentication protocol) than in-band (treating the middlebox as a participant in a 3+ party communication).</p>
<h1 id="rfc.section.7.4"><a href="#rfc.section.7.4">7.4.</a> <a href="#in-band-out-of-band-piggybacked-and-interleaved-signaling" id="in-band-out-of-band-piggybacked-and-interleaved-signaling">In-band, out-of-band, piggybacked, and interleaved signaling</a></h1>
<p id="rfc.section.7.4.p.1">Discussions about SPUD to date have focused on the possibility of in-band signaling from endpoints to middleboxes and back &#8211; the signaling channel happens on the same 5-tuple as the data carried by the superstrate. However, there are a wide variety of potential signaling arrangements: in-band signaling can be piggybacked (where signaling happens on packets sent by the superstrate) and/or interleaved (where SPUD and the superstrate each have their own packets).  Signaling can also be out-of-band (on a different five tuple, or even over a completely different protocol). Out of band signaling for path-to-endpoint information can use direct return, allowing a device on the path to communicate directly with an endpoint (i.e., as with ICMP). More discussion on the tradeoffs here is given in <a href="#stackevo-explicit-coop">[stackevo-explicit-coop]</a>.</p>
<p id="rfc.section.7.4.p.2">The tradeoffs here must be carefully weighed, and the final approach may use a mix of all these communication patterns where SPUD provides different signaling patterns for different situations. E.g., a middlebox might need to generate out-of-band signals for error messages or can provide requested information in-band and feedback over the receiver if a minimum or maximum value from all SPUD-aware middleboxes on path should be discovered.</p>
<h1 id="rfc.section.7.5"><a href="#rfc.section.7.5">7.5.</a> <a href="#continuum-of-trust-among-endpoints-and-middleboxes" id="continuum-of-trust-among-endpoints-and-middleboxes">Continuum of trust among endpoints and middleboxes</a></h1>
<p id="rfc.section.7.5.p.1">There are different security considerations for different security contexts.  The end-to-end context is one; anything that only needs to be seen by the path shouldn&#8217;t be exposed in SPUD, but rather by the superstrate. There are multiple different types of end-to-middle context based on levels of trust between end and middle &#8211; is the middlebox on the same network as the endpoint, under control of the same owner? Is there some contract between the application user and the middlebox operator? SPUD should support different levels of trust than the default (&#8220;untrusted, but presumed honest due to limitations on the signaling vocabulary&#8221;) and fully-authenticated; how these points along the continuum are to be implemented and how they relate to each other needs to be explored further.</p>
<h1 id="rfc.section.7.6"><a href="#rfc.section.7.6">7.6.</a> <a href="#discovery-and-capability-exposure" id="discovery-and-capability-exposure">Discovery and capability exposure</a></h1>
<p id="rfc.section.7.6.p.1">There are three open issues in discovery and capability exposure. First, an endpoint needs to discover if the other communication endpoint understands SPUD. Second, endpoints need to test whether SPUD is potentially not usable along a path because of middleboxes that block SPUD packets or strip the SPUD header. If such impairments exist in the path, a SPUD sender needs to fall back to some other approach to achieve the goals of the superstrate.  Third, endpoints might want to be able to discover SPUD-aware middleboxes along the path, and to discover which parts of the vocabulary that can be spoken by the endpoints are supported by those middleboxes as well as the other communication endpoint, and vice versa.</p>
<p id="rfc.section.7.6.p.2">In addition, endpoints may need to discover and negotiate which superstrates are available for a given interaction. SPUD could assist here. However, it is explicitly not a goal of SPUD to expose information about the details of the superstrate to middleboxes.</p>
<h1 id="rfc.section.7.7"><a href="#rfc.section.7.7">7.7.</a> <a href="#hard-state-vs-soft-state" id="hard-state-vs-soft-state">Hard state vs. soft state</a></h1>
<p id="rfc.section.7.7.p.1">The initial thinking on signaling envisions &#8220;hard state&#8221; in middleboxes that is established when the middlebox observes the start of a SPUD tube and is torn down when the middlebox observes the end (stop) of a SPUD tube.  Such state can be abandoned as a result of network topology changes (e.g., routing update in response to link or node failure).  An alternative is a &#8220;soft state&#8221; approach that requires periodic refresh of state in middleboxes, but cleanly times out and discards abandoned state.  SPUD has the opportunity to use different timeouts than the defaults that are required for current NAT and firewall pinhole maintenance. Of course, applications will still have to detect non-SPUD middleboxes that use shorter timers.</p>
<h1 id="rfc.section.7.8"><a href="#rfc.section.7.8">7.8.</a> <a href="#tube-vs-superstrate-association-lifetime" id="tube-vs-superstrate-association-lifetime">Tube vs. superstrate association lifetime</a></h1>
<p id="rfc.section.7.8.p.1">The requirements as presently defined use tube start and stop signaling for two things: (1) setting up and tearing down state along the path, and (2) signaling superstrate such as association startup, acceptance, and teardown, which may have security implications. These may require separate signaling.  Specifically, if tube start acknowledgement is to be used to provide explicit guarantees to the path about the acceptability of a tube to a remote endpoint, it cannot be a completely unreliable signal. Second, the lifetime of a tube may be much shorter than the lifetime of a superstrate association, and the creation of a new tube over an existing association may need to be treated differently by endpoints and path devices than a tube creation coincident with an association creation.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a></h1>
<p id="rfc.section.8.p.1">The security-relevant requirements for SPUD deal mainly with endpoint authentication and the integrity of exposed information (<a href="#authentication">Section 5.6</a>, <a href="#integrity">Section 5.8</a>, <a href="#privacy">Section 5.9</a>, and <a href="#tradeoffs-in-integrity-protection">Section 7.3</a>); protection against attacks (<a href="#proof-of-topology">Section 5.7</a>, <a href="#protection-against-trivial-abuse">Section 6.5</a>, and <a href="#tradeoffs-in-tube-identifiers">Section 7.1</a> and); and the trust relationships among endpoints and middleboxes <a href="#continuum-of-trust-among-endpoints-and-middleboxes">Section 7.5</a>. These will be further addressed in protocol definition work following from these requirements.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a></h1>
<p id="rfc.section.9.p.1">This document has no actions for IANA.</p>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#contributors" id="contributors">Contributors</a></h1>
<p id="rfc.section.10.p.1">In addition to the editors, this document is the work of David Black, Ken Calvert, Ted Hardie, Joe Hildebrand, Jana Iyengar, and Eric Rescorla.</p>
<h1 id="rfc.section.11"><a href="#rfc.section.11">11.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.11.p.1">Thanks to Roland Bless, Cameron Byrne, Toerless Eckert, Daniel Kahn Gillmor, Tom Herbert, and Christian Huitema for feedback and comments on these requirements, as well as to the participants at the SPUD BoF at IETF 92 meeting in Dallas inand the IAB SEMI workshop in Zurich for the discussions leading to this work.</p>
<h1 id="rfc.references"><a href="#rfc.references">12.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC0792">[RFC0792]</b>
      </td>
      <td class="top"><a title="University of Southern California (USC)/Information Sciences Institute">Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc792">Internet Control Message Protocol</a>", STD 5, RFC 792, September 1981.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2827">[RFC2827]</b>
      </td>
      <td class="top"><a>Ferguson, P.</a> and <a>D. Senie</a>, "<a href="http://tools.ietf.org/html/rfc2827">Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing</a>", BCP 38, RFC 2827, May 2000.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6347">[RFC6347]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a> and <a>N. Modadugu</a>, "<a href="http://tools.ietf.org/html/rfc6347">Datagram Transport Layer Security Version 1.2</a>", RFC 6347, January 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7510">[RFC7510]</b>
      </td>
      <td class="top"><a>Xu, X.</a>, <a>Sheth, N.</a>, <a>Yong, L.</a>, <a>Callon, R.</a> and <a>D. Black</a>, "<a href="http://tools.ietf.org/html/rfc7510">Encapsulating MPLS in UDP</a>", RFC 7510, April 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.hildebrand-spud-prototype">[I-D.hildebrand-spud-prototype]</b>
      </td>
      <td class="top"><a>Hildebrand, J.</a> and <a>B. Trammell</a>, "<a href="http://tools.ietf.org/html/draft-hildebrand-spud-prototype-03">Substrate Protocol for User Datagrams (SPUD) Prototype</a>", Internet-Draft draft-hildebrand-spud-prototype-03, March 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.huitema-tls-dtls-as-subtransport">[I-D.huitema-tls-dtls-as-subtransport]</b>
      </td>
      <td class="top"><a>Huitema, C.</a>, <a>Rescorla, E.</a> and <a>J. Jana</a>, "<a href="http://tools.ietf.org/html/draft-huitema-tls-dtls-as-subtransport-00">DTLS as Subtransport protocol</a>", Internet-Draft draft-huitema-tls-dtls-as-subtransport-00, March 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="stackevo-explicit-coop">[stackevo-explicit-coop]</b>
      </td>
      <td class="top"><a>Trammell, B.</a>, "<a>Architectural Considerations for Transport Evolution with Explicit Path Cooperation</a>", September 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.iab-semi-report">[I-D.iab-semi-report]</b>
      </td>
      <td class="top"><a>Trammell, B.</a> and <a>M. Kuehlewind</a>, "<a href="http://tools.ietf.org/html/draft-iab-semi-report-00">IAB Workshop on Stack Evolution in a Middlebox Internet (SEMI) Report</a>", Internet-Draft draft-iab-semi-report-00, June 2015.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Trammell</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Trammell</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  <span class="vcardline">Gloriastrasse 35</span>

	  <span class="vcardline">
		<span class="locality">8092 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ietf@trammell.ch">ietf@trammell.ch</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mirja Kuehlewind</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Kuehlewind</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  <span class="vcardline">Gloriastrasse 35</span>

	  <span class="vcardline">
		<span class="locality">8092 Zurich</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mirja.kuehlewind@tik.ee.ethz.ch">mirja.kuehlewind@tik.ee.ethz.ch</a></span>

  </address>
</div>

</body>
</html>
